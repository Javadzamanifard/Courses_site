{% extends "_base.html" %}
{% load i18n static %}

{% block title %}{{ course.title }}{% endblock %}

{% block CSS %}
<link rel="stylesheet" href="{% static 'css/course_detail.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Ø¹Ù†ÙˆØ§Ù† Ø¯ÙˆØ±Ù‡ -->
    <div class="course-header text-center mb-5">
    <h1>{{ course.title }}</h1>
    {% if course.subtitle %}
    <p class="text-muted fs-5 mt-2">{{ course.subtitle }}</p>
    {% endif %}
  </div>
  <!-- Ø¯Ú©Ù…Ù‡ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ø´Ø¬ÙˆÛŒØ§Ù† -->
      <div class="enroll-container mt-4">
        {% if user.is_authenticated %}
          <form method="post" action="{% url 'courses:enroll' course.slug %}">
            {% csrf_token %}
            <button type="submit" class="enroll-btn">
              ğŸ“ {% trans "Enroll in course" %}
            </button>
          </form>
        {% else %}
          <a href="{% url 'account_login' %}?next={{ request.path }}" class="enroll-btn">
            ğŸ”‘ {% trans "Login To Enroll" %}
          </a>
        {% endif %}
        <p class="student-count mt-2">
          ğŸ‘¥ {% trans "Number Of Students" %}: <strong>{{ course.enrollments.count }}</strong>
        </p>
      </div>
    </div>




  <!-- Ø¢Ú©Ø§Ø±Ø¯Ø¦ÙˆÙ† ÙØµÙ„â€ŒÙ‡Ø§ -->
  <div class="accordion" id="courseAccordion">
    {% regroup course.lessons.all by order as grouped_lessons %}
    {% for group in grouped_lessons %}
    <div class="accordion-item mb-4">
      <h2 class="accordion-header" id="heading{{ forloop.counter }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
          data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false"
          aria-controls="collapse{{ forloop.counter }}">
          ğŸŒ¿ {% trans "ÙØµÙ„" %} {{ group.grouper }}
        </button>
      </h2>
      <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse"
        aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#courseAccordion">
        <div class="accordion-body lesson-scroll">
          {% for lesson in group.list %}
          <div class="lesson-item">
            <span class="lesson-title">{{ lesson.title }}</span>
            <div class="d-flex align-items-center gap-3">
              <small class="text-muted">{{ lesson.duration }}</small>
              {% if lesson.video %}
              <button class="play-btn" data-bs-toggle="modal" data-bs-target="#videoModal{{ lesson.id }}">
                <i class="bi bi-play-fill fs-5"></i>
              </button>
              {% endif %}
            </div>
          </div>

          <!-- Modal ÙˆÛŒØ¯ÛŒÙˆ -->
          {% if lesson.video %}
          <div class="modal fade" id="videoModal{{ lesson.id }}" tabindex="-1"
            aria-labelledby="videoModalLabel{{ lesson.id }}" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header border-0">
                  <h5 class="modal-title">{{ lesson.title }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                  <video class="w-100 rounded-bottom" controls>
                    <source src="{{ lesson.video.url }}" type="video/mp4">
                    {% trans "ÙˆÛŒØ¯Ø¦Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯." %}
                  </video>
                </div>
              </div>
            </div>
          </div>
          {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯ÙˆØ±Ù‡ -->
  {% if course.description %}
  <div class="course-description">
    <h4>{% trans "ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¯ÙˆØ±Ù‡" %}</h4>
    <p>{{ course.description|safe }}</p>
  </div>
  {% endif %}
</div>
{% endblock %}

